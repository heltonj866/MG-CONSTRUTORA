<!DOCTYPE html>
<html lang="pt-BR" class="bg-gray-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GeoObras Pro - Sistema Completo</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        /* Estilos de App Nativo */
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .app-frame { max-width: 430px; margin: 0 auto; background: #F3F4F6; min-height: 100vh; position: relative; padding-bottom: 90px; box-shadow: 0 0 50px rgba(0,0,0,0.15); overflow-x: hidden; }
        
        /* Utilitários Interativos */
        .weather-btn.selected {
            background-color: #facc15; /* Tailwind bg-yellow-400 */
            border-color: #eab308;    /* Tailwind border-yellow-500 */
            color: #0f172a;           /* Tailwind text-slate-900 */
            font-weight: bold;
        }
        .tab-btn.active {
            color: #2563eb;           /* Tailwind text-blue-600 */
            border-bottom-width: 2px; /* Tailwind border-b-2 */
            border-color: #2563eb;    /* Tailwind border-blue-600 */
        }
        .nav-item.active {
            color: #2563eb;           /* Tailwind text-blue-600 */
        }
        .hidden-screen { display: none !important; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        .slide-up { animation: slideUp 0.3s ease-out; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        /* Toggles (Switches) do iOS */
        .toggle-checkbox:checked { right: 0; border-color: #10B981; }
        .toggle-checkbox:checked + .toggle-label { background-color: #10B981; }
    </style>
</head>
<body>

<div class="app-frame">
    
    <header class="bg-slate-900 text-white p-4 flex justify-between items-center sticky top-0 z-50 shadow-md">
        <div class="flex items-center gap-3">
            <i class="fa-solid fa-helmet-safety text-yellow-400 text-xl"></i>
            <h1 class="font-bold text-lg tracking-tight">GeoObras <span class="font-normal text-yellow-400">Pro</span></h1>
        </div>
        <div onclick="toggleOffline()" id="offline-badge" class="bg-green-500 text-xs font-bold px-3 py-1 rounded-full flex items-center gap-2 cursor-pointer">
            <i class="fa-solid fa-wifi"></i> <span>Online</span>
        </div>
    </header>

    <main id="screen-home" class="screen fade-in p-4">
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-slate-800">Olá, Eng. Carlos</h2>
            <p class="text-gray-500 text-sm"><i class="fa-regular fa-calendar mr-1"></i> <span id="data-hoje-dash"></span></p>
        </div>

        <div class="flex gap-3 mb-6 overflow-x-auto pb-2">
             <div class="bg-blue-600 text-white p-4 rounded-xl min-w-[140px] shadow-sm">
                <h3 class="text-2xl font-bold mb-1">3</h3><p class="text-sm opacity-90">Obras Ativas</p>
             </div>
             <div class="bg-white text-slate-800 p-4 rounded-xl border border-gray-200 min-w-[140px] shadow-sm">
                <h3 class="text-2xl font-bold mb-1 text-red-500">1</h3><p class="text-sm text-gray-500">Pendência</p>
             </div>
        </div>

        <h3 class="text-gray-500 text-sm font-bold uppercase tracking-wide mb-3">Meus Canteiros</h3>
        
        <div class="space-y-4 mb-20">
            <div onclick="navigateTo('form', {obra: 'Residencial Vila Verde', end: 'Rua das Flores, 123'})" class="bg-white rounded-xl p-4 shadow-sm border border-gray-200 active:scale-[0.98] transition-all cursor-pointer relative overflow-hidden group hover:border-blue-400">
                <div class="absolute top-0 right-0 w-2 h-full bg-green-500"></div>
                <div class="flex justify-between items-start mb-2 pr-4">
                    <h3 class="font-bold text-lg text-slate-800">Res. Vila Verde</h3>
                    <span class="bg-green-100 text-green-800 text-[10px] font-bold px-2 py-1 rounded-full uppercase">Em dia</span>
                </div>
                <p class="text-gray-500 text-xs mb-4"><i class="fa-solid fa-location-dot mr-1"></i> Centro, Teresina-PI</p>
                <div class="flex items-center justify-between text-xs font-medium text-gray-500">
                    <span>Progresso: 45%</span><span><i class="fa-solid fa-arrow-right"></i> Preencher RDO</span>
                </div>
            </div>
            
            <div onclick="navigateTo('form', {obra: 'Edifício Horizonte', end: 'Av. Paulista, 900'})" class="bg-white rounded-xl p-4 shadow-sm border border-red-200 active:scale-[0.98] transition-all cursor-pointer relative overflow-hidden group hover:border-red-400">
                <div class="absolute top-0 right-0 w-2 h-full bg-red-500"></div>
                <div class="flex justify-between items-start mb-2 pr-4">
                    <h3 class="font-bold text-lg text-slate-800">Ed. Horizonte</h3>
                    <span class="bg-red-100 text-red-800 text-[10px] font-bold px-2 py-1 rounded-full uppercase">Atenção</span>
                </div>
                <div class="text-xs font-bold text-red-500"><i class="fa-solid fa-triangle-exclamation"></i> Relatório Pendente</div>
            </div>
        </div>
    </main>

    <main id="screen-form" class="screen hidden-screen fade-in bg-white pb-20">
        <div class="bg-white p-4 sticky top-[60px] z-40 border-b border-gray-100 flex items-center gap-4 shadow-sm">
            <button onclick="navigateTo('home')" class="text-slate-500 hover:bg-gray-100 p-2 rounded-full"><i class="fa-solid fa-arrow-left text-xl"></i></button>
            <div><p class="text-[10px] text-gray-500 uppercase font-bold tracking-wider">Novo Relatório</p><h2 id="form-obra-titulo" class="font-bold text-slate-900 leading-tight">Nome da Obra</h2></div>
        </div>

        <div class="p-4 space-y-8">
            <section>
                <h3 class="font-bold text-slate-800 mb-4 text-lg"><i class="fa-solid fa-cloud-sun text-blue-600"></i> 1. Clima</h3>
                <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                    <p class="text-xs font-bold text-gray-500 mb-2">MANHÃ</p>
                    <div class="grid grid-cols-3 gap-2" id="clima-manha">
                        <button onclick="selectClima('manha', this)" class="weather-btn selected bg-white border border-gray-300 py-3 rounded-lg flex flex-col items-center"><i class="fa-solid fa-sun"></i><span class="text-[10px]">Sol</span></button>
                        <button onclick="selectClima('manha', this)" class="weather-btn bg-white border border-gray-300 py-3 rounded-lg flex flex-col items-center"><i class="fa-solid fa-cloud"></i><span class="text-[10px]">Nub</span></button>
                        <button onclick="selectClima('manha', this)" class="weather-btn bg-white border border-gray-300 py-3 rounded-lg flex flex-col items-center"><i class="fa-solid fa-cloud-rain"></i><span class="text-[10px]">Chuv</span></button>
                    </div>
                </div>
            </section>

            <section>
                 <h3 class="font-bold text-slate-800 mb-4 text-lg"><i class="fa-solid fa-users-gear text-blue-600"></i> 2. Equipe</h3>
                 <div class="space-y-2">
                    <div class="flex justify-between items-center bg-white p-3 border rounded-xl">
                        <span>Pedreiros</span>
                        <div class="flex gap-3 bg-gray-100 rounded-full p-1"><button onclick="updateCount('pedreiro', -1)" class="w-8 h-8 bg-white font-bold rounded-full">-</button><span id="val-pedreiro" class="font-bold w-6 text-center pt-1">4</span><button onclick="updateCount('pedreiro', 1)" class="w-8 h-8 bg-slate-800 text-white font-bold rounded-full">+</button></div>
                    </div>
                 </div>
            </section>

            <section>
                <h3 class="font-bold text-slate-800 mb-2 text-lg"><i class="fa-solid fa-clipboard-list text-blue-600"></i> 3. Atividades</h3>
                <textarea id="txt-atividades" class="w-full h-24 p-4 border rounded-xl bg-gray-50" placeholder="Descreva atividades...">Concretagem da laje e alvenaria.</textarea>
            </section>

             <div class="pt-6 border-t border-gray-200">
                <button id="btn-finalizar" onclick="processAndDownloadPDF()" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-slate-900 font-black text-lg py-4 rounded-xl shadow-lg flex justify-center items-center gap-3"><i class="fa-solid fa-file-signature text-xl"></i> FINALIZAR PDF</button>
             </div>
        </div>
    </main>

    <main id="screen-history" class="screen hidden-screen fade-in p-4">
        <h2 class="text-2xl font-bold text-slate-800 mb-6">Histórico de RDOs</h2>
        
        <div class="flex gap-2 mb-6">
            <button class="bg-slate-800 text-white px-4 py-2 rounded-full text-xs font-bold">Todos</button>
            <button class="bg-white border text-gray-500 px-4 py-2 rounded-full text-xs font-bold">Pendentes</button>
            <button class="bg-white border text-gray-500 px-4 py-2 rounded-full text-xs font-bold">Assinados</button>
        </div>

        <div id="history-list" class="space-y-3">
            </div>
    </main>

    <main id="screen-settings" class="screen hidden-screen fade-in p-4">
        <div class="flex items-center gap-4 mb-8 bg-white p-4 rounded-xl shadow-sm border border-gray-200">
            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-2xl font-bold border-2 border-white shadow">CF</div>
            <div>
                <h2 class="text-xl font-bold text-slate-800">Carlos Ferreira</h2>
                <p class="text-sm text-gray-500">CREA 12345/PI</p>
                <p class="text-xs text-green-600 font-bold mt-1">● Plano Pro Ativo</p>
            </div>
        </div>

        <div class="space-y-4">
            <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
                <div class="p-4 bg-gray-50 text-xs font-bold text-gray-400 uppercase tracking-wider">Sistema</div>
                
                <div class="p-4 flex justify-between items-center border-b border-gray-100">
                    <div class="flex items-center gap-3 text-slate-700 font-medium">
                        <div class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-blue-500"><i class="fa-solid fa-bell"></i></div>
                        Notificações
                    </div>
                    <div onclick="toggleSwitch(this)" class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                        <div class="w-10 h-6 bg-gray-300 rounded-full toggle-bg transition-colors"></div>
                        <div class="absolute left-1 top-1 w-4 h-4 bg-white border border-gray-300 rounded-full transition-transform transform toggle-dot"></div>
                    </div>
                </div>

                <div class="p-4 flex justify-between items-center border-b border-gray-100">
                    <div class="flex items-center gap-3 text-slate-700 font-medium">
                        <div class="w-8 h-8 rounded-full bg-orange-50 flex items-center justify-center text-orange-500"><i class="fa-solid fa-wifi"></i></div>
                        Sincronizar só no Wi-Fi
                    </div>
                    <div onclick="toggleSwitch(this)" class="active relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                        <div class="w-10 h-6 bg-green-500 rounded-full toggle-bg transition-colors"></div>
                        <div class="absolute left-1 top-1 w-4 h-4 bg-white border border-gray-300 rounded-full transition-transform transform translate-x-4 toggle-dot"></div>
                    </div>
                </div>
            </div>

            <button class="w-full bg-white text-red-500 font-bold py-4 rounded-xl border border-red-100 flex justify-center items-center gap-2 hover:bg-red-50">
                <i class="fa-solid fa-right-from-bracket"></i> Sair da Conta
            </button>
        </div>
        <p class="text-center text-xs text-gray-400 mt-8">Versão 2.1.0 - GeoObras Tecnologia</p>
    </main>

    <div id="quick-action-modal" class="hidden-screen fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm flex items-end justify-center" onclick="toggleQuickAction()">
        <div class="bg-white w-full max-w-[430px] rounded-t-2xl p-6 slide-up" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-lg text-slate-800">O que deseja fazer?</h3>
                <button onclick="toggleQuickAction()" class="w-8 h-8 bg-gray-100 rounded-full text-gray-500"><i class="fa-solid fa-xmark"></i></button>
            </div>
            
            <div class="grid grid-cols-3 gap-4 mb-4">
                <button onclick="quickAction('form')" class="flex flex-col items-center gap-2 group">
                    <div class="w-16 h-16 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center text-2xl group-active:scale-95 transition-transform"><i class="fa-solid fa-file-pen"></i></div>
                    <span class="text-xs font-bold text-gray-600">Novo RDO</span>
                </button>
                <button onclick="alert('Funcionalidade: Cadastro de Obra')" class="flex flex-col items-center gap-2 group">
                    <div class="w-16 h-16 bg-purple-50 text-purple-600 rounded-2xl flex items-center justify-center text-2xl group-active:scale-95 transition-transform"><i class="fa-solid fa-building-user"></i></div>
                    <span class="text-xs font-bold text-gray-600">Nova Obra</span>
                </button>
                <button onclick="alert('Funcionalidade: Novo Funcionário')" class="flex flex-col items-center gap-2 group">
                    <div class="w-16 h-16 bg-green-50 text-green-600 rounded-2xl flex items-center justify-center text-2xl group-active:scale-95 transition-transform"><i class="fa-solid fa-user-plus"></i></div>
                    <span class="text-xs font-bold text-gray-600">Equipe</span>
                </button>
            </div>
        </div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-gray-200 flex justify-around py-2 z-50 max-w-[430px] mx-auto">
        <button onclick="navigateTo('home')" id="nav-home" class="nav-item active flex flex-col items-center w-1/4 py-2 text-blue-600 transition-colors"><i class="fa-solid fa-house text-xl mb-1"></i><span class="text-[10px] font-bold">Obras</span></button>
        <button onclick="toggleQuickAction()" class="flex flex-col items-center w-1/4 relative -top-5"><div class="bg-yellow-400 w-14 h-14 rounded-full flex items-center justify-center shadow-lg border-4 border-white text-slate-900 active:scale-95 transition-transform"><i class="fa-solid fa-plus text-2xl"></i></div></button>
        <button onclick="navigateTo('history')" id="nav-history" class="nav-item flex flex-col items-center w-1/4 py-2 text-gray-400 transition-colors"><i class="fa-solid fa-clock-rotate-left text-xl mb-1"></i><span class="text-[10px] font-bold">Histórico</span></button>
        <button onclick="navigateTo('settings')" id="nav-settings" class="nav-item flex flex-col items-center w-1/4 py-2 text-gray-400 transition-colors"><i class="fa-solid fa-user-gear text-xl mb-1"></i><span class="text-[10px] font-bold">Ajustes</span></button>
    </nav>

</div>

<script>
    // --- DADOS MOCKADOS (Simula Banco de Dados) ---
    const mockHistory = [
        { id: 45, obra: "Res. Vila Verde", data: "Ontem", status: "assinado", clima: "Sol" },
        { id: 44, obra: "Res. Vila Verde", data: "01/Fev", status: "assinado", clima: "Nublado" },
        { id: 12, obra: "Ed. Horizonte", data: "Hoje", status: "rascunho", clima: "-" },
        { id: 11, obra: "Ed. Horizonte", data: "30/Jan", status: "pendente", clima: "Chuva" }
    ];

    // --- NAVEGAÇÃO ---
    function navigateTo(screenId, params = {}) {
        document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden-screen'));
        document.getElementById(`screen-${screenId}`).classList.remove('hidden-screen');
        
        // Atualiza Menu Inferior
        document.querySelectorAll('.nav-item').forEach(n => {
            n.classList.remove('active', 'text-blue-600');
            n.classList.add('text-gray-400');
        });
        const navTarget = document.getElementById(`nav-${screenId}`);
        if(navTarget) {
            navTarget.classList.add('active', 'text-blue-600');
            navTarget.classList.remove('text-gray-400');
        }

        window.scrollTo(0,0);
        
        // Carregamentos Específicos
        if(screenId === 'form' && params.obra) {
            document.getElementById('form-obra-titulo').innerText = params.obra;
        }
        if(screenId === 'history') {
            loadHistory();
        }
    }

    // --- FUNÇÕES DE HISTÓRICO ---
    function loadHistory() {
        const list = document.getElementById('history-list');
        list.innerHTML = ""; // Limpa lista

        mockHistory.forEach(item => {
            let statusBadge = "";
            let btnAction = "";
            
            if(item.status === 'assinado') {
                statusBadge = `<span class="bg-green-100 text-green-700 text-[10px] font-bold px-2 py-1 rounded-full"><i class="fa-solid fa-check"></i> Assinado</span>`;
                btnAction = `<button onclick="alert('Baixando PDF #${item.id}...')" class="text-blue-600 text-xs font-bold border border-blue-200 px-3 py-1 rounded-lg hover:bg-blue-50"><i class="fa-solid fa-download"></i> PDF</button>`;
            } else if (item.status === 'rascunho') {
                statusBadge = `<span class="bg-yellow-100 text-yellow-700 text-[10px] font-bold px-2 py-1 rounded-full"><i class="fa-solid fa-pen"></i> Rascunho</span>`;
                btnAction = `<button onclick="navigateTo('form', {obra: '${item.obra}'})" class="text-yellow-600 text-xs font-bold border border-yellow-200 px-3 py-1 rounded-lg hover:bg-yellow-50">Continuar</button>`;
            } else {
                statusBadge = `<span class="bg-red-100 text-red-700 text-[10px] font-bold px-2 py-1 rounded-full"><i class="fa-solid fa-clock"></i> Atrasado</span>`;
                btnAction = `<button onclick="navigateTo('form', {obra: '${item.obra}'})" class="text-red-600 text-xs font-bold border border-red-200 px-3 py-1 rounded-lg hover:bg-red-50">Resolver</button>`;
            }

            const html = `
            <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex justify-between items-center">
                <div>
                    <h4 class="font-bold text-slate-800 text-sm">${item.obra}</h4>
                    <p class="text-xs text-gray-500 mt-1"><i class="fa-regular fa-calendar"></i> ${item.data} • Clima: ${item.clima}</p>
                </div>
                <div class="text-right flex flex-col items-end gap-2">
                    ${statusBadge}
                    ${btnAction}
                </div>
            </div>`;
            list.insertAdjacentHTML('beforeend', html);
        });
    }

    // --- FUNÇÕES DE AJUSTES (TOGGLES) ---
    function toggleSwitch(element) {
        const bg = element.querySelector('.toggle-bg');
        const dot = element.querySelector('.toggle-dot');
        
        // Simples lógica visual de toggle
        if (bg.classList.contains('bg-green-500')) {
            // Desliga
            bg.classList.remove('bg-green-500');
            bg.classList.add('bg-gray-300');
            dot.classList.remove('translate-x-4');
        } else {
            // Liga
            bg.classList.remove('bg-gray-300');
            bg.classList.add('bg-green-500');
            dot.classList.add('translate-x-4');
        }
    }

    // --- MENU DE AÇÃO RÁPIDA ---
    function toggleQuickAction() {
        const modal = document.getElementById('quick-action-modal');
        if(modal.classList.contains('hidden-screen')) {
            modal.classList.remove('hidden-screen');
        } else {
            modal.classList.add('hidden-screen');
        }
    }

    function quickAction(action) {
        toggleQuickAction(); // Fecha modal
        if(action === 'form') {
            // Reseta form e vai
            document.getElementById('txt-atividades').value = "";
            navigateTo('form', {obra: 'Nova Obra Selecionada'});
        }
    }

    // --- PDF E FORMULÁRIO (Mantido do anterior) ---
    let rdoData = { mestre: 1, pedreiro: 4, servente: 3 };
    const options = { weekday: 'long', day: 'numeric', month: 'long' };
    document.getElementById('data-hoje-dash').innerText = new Date().toLocaleDateString('pt-BR', options);

    function selectClima(periodo, btn) {
        document.querySelectorAll(`#clima-${periodo} .weather-btn`).forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
    }

    function updateCount(id, delta) {
        let el = document.getElementById(`val-${id}`);
        let val = parseInt(el.innerText) + delta;
        if(val >= 0) el.innerText = val;
    }

    async function processAndDownloadPDF() {
        const btn = document.getElementById('btn-finalizar');
        const originalHtml = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> GERANDO...';
        btn.classList.add('bg-gray-400');
        
        setTimeout(() => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Layout Simples do PDF para Demo
            doc.setFillColor(40, 40, 40); doc.rect(0, 0, 210, 30, 'F');
            doc.setTextColor(255, 255, 255); doc.setFontSize(16);
            doc.text("RELATÓRIO DIÁRIO DE OBRA", 105, 12, null, null, "center");
            
            doc.setTextColor(0,0,0); doc.setFontSize(12);
            doc.text(`Atividades: ${document.getElementById('txt-atividades').value}`, 14, 50);
            
            doc.save(`RDO_Demo.pdf`);
            
            btn.innerHTML = originalHtml;
            btn.classList.remove('bg-gray-400');
            alert("✅ PDF Gerado e salvo no histórico!");
            navigateTo('history'); // Redireciona para o histórico após salvar
        }, 1500);
    }
</script>

</body>
</html>